(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[463],{2466:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/WindowChat",function(){return n(1101)}])},7200:function(e,t,n){"use strict";var l=n(4533);t.Z=function(){return{storageMessage:async function(e){if(e.content&&e)try{return await l.Z.post("/messages/create",e)}catch(e){console.log("deu ruim:",e);return}},getListMessage:async function(e){let t=localStorage.getItem("token")||"";try{return(await l.Z.post("/messages/listmessages",{chattingToEmail:e},{headers:{Authorization:"Bearer ".concat(JSON.parse(t))}})).data.listMessages}catch(e){console.log("deu ruim:",e)}}}}},1101:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var l=n(5893),s=n(7294),a=n(3228),i=n(8773),o=n(7200),c=n(9696),r=n(8647),u=function(){let{socket:e,chattingTo:t,userLoged:n}=(0,s.useContext)(a._),i={from:"",to:"",content:"",_id:""},[u,m]=(0,s.useState)(i),{storageMessage:d}=(0,o.Z)();return(0,l.jsx)("form",{className:" sticky  w-full bg-slate-800 flex justify-center text-white",onSubmit:function(t){t.preventDefault(),u.content&&(null==e||e.emit("message",u),m(i))},children:(0,l.jsxs)("div",{className:" flex align-middle",children:[(0,l.jsx)("div",{className:" pt-5",children:(0,l.jsx)(c.Z,{type:"text",textLabel:"",name:"message",placeholder:"mensagem",handleOnChange:function(e){m({from:n.email,to:(null==t?void 0:t.email)?t.email:"",content:e.target.value,_id:(0,r.x0)()})},value:u.content})}),(0,l.jsx)("input",{type:"submit",value:"Enviar",className:" cursor-pointer border border-green-500 mt-2  \n ml-2 px-2 max-h-9 hover:bg-gray-900"})]})})},m=function(){let{userLoged:e,messageList:t,chattingTo:n,setMessageList:i}=(0,s.useContext)(a._),o=(0,s.useRef)(null);return(0,s.useEffect)(()=>{var e;(null==t?void 0:t.length)>0&&(null===(e=o.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))},[t]),(0,s.useEffect)(()=>{n||i([])},[n]),(0,l.jsx)("div",{className:"h-full box pt-1",children:(null==t?void 0:t.length)===0?(0,l.jsx)("div",{className:" px-1 h-full text-center",children:"sem menssagens no momento"}):(0,l.jsxs)("ul",{className:" overflow-y-scroll px-1 h-full max-h-[80.6vh]",children:[null==t?void 0:t.map((t,n)=>(0,l.jsxs)("li",{className:"".concat(e.email===t.from?"bg-green-500 ml-auto":"bg-gray-500"," flex flex-col  max-w-max px-2 mb-1"),children:[(0,l.jsx)("p",{className:" text-[0.7em]",children:e.email===t.from?"vo\xe7\xea":t.from}),(0,l.jsx)("p",{className:" text-[1em]",children:t.content})]},n)),(0,l.jsx)("div",{className:"",ref:o})]})})},d=function(){let{storageMessage:e,getListMessage:t}=(0,o.Z)(),{socket:n,userLoged:c,contactList:r,messageList:d,chattingTo:f,setMessageList:x,returnList:h,setModalStatus:g,modalStatus:v}=(0,s.useContext)(a._);return(0,s.useEffect)(()=>{n&&function(){let t=async t=>{await e(t),d.find(e=>e._id===(null==t?void 0:t._id))||x(e=>[...e,t])};null==n||n.on("receive_message",t),()=>{null==n||n.off("receive_message",t)}}()},[n,null==f?void 0:f.email]),(0,s.useEffect)(()=>{if((null==d?void 0:d.length)>0){let e=d.filter((e,t,n)=>t===n.findIndex(t=>t._id===e._id));e.length!==d.length&&x(e)}},[d]),(0,s.useEffect)(()=>{(async()=>{(null==f?void 0:f.email)&&x(await t(f.email))})()},[f]),(0,l.jsxs)("div",{className:" flex flex-col w-full h-screen",children:[(0,l.jsx)("h1",{className:" text-center text-xl bg-slate-800",children:(null==r?void 0:r.length)>0&&(0,l.jsxs)("div",{className:"my-4 ",children:["Falando com :",(0,l.jsxs)("span",{className:"text-green-600",children:[" ",null==f?void 0:f.email]}),(0,l.jsx)("button",{className:" ml-2",onClick:function(){g({item:"".concat(null==f?void 0:f._id),modeOperation:"deleteContact"})},children:(0,l.jsx)(i.AMf,{})})]})}),(0,l.jsx)(m,{}),(0,l.jsx)(u,{})]})}}},function(e){e.O(0,[365,888,774,179],function(){return e(e.s=2466)}),_N_E=e.O()}]);