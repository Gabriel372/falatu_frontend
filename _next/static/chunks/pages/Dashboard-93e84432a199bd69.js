(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[156],{6274:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Dashboard",function(){return n(6336)}])},7200:function(e,t,n){"use strict";var s=n(4533);t.Z=function(){return{storageMessage:async function(e){if(e.content&&e)try{return await s.Z.post("/messages/create",e)}catch(e){console.log("deu ruim:",e);return}},getListMessage:async function(e){let t=localStorage.getItem("token")||"";try{return(await s.Z.post("/messages/listmessages",{chattingToEmail:e},{headers:{Authorization:"Bearer ".concat(JSON.parse(t))}})).data.listMessages}catch(e){console.log("deu ruim:",e)}}}}},6336:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var s=n(5893),l=n(7294),a=n(3228),i=n(1101),c=n(3770),r=n(3607),o=n(7200),u=n(1664),d=n.n(u),m=function(){let{setModalStatus:e,setMessageList:t,setChattingTo:n,setContactList:i,chattingTo:u,contactList:m,modalStatus:x,socket:f,userLoged:h}=(0,l.useContext)(a._),{getAllContacts:g}=(0,c.Z)(),{getListMessage:v}=(0,o.Z)(),j=localStorage.getItem("token");function N(e){i(t=>t.some(t=>t._id===e._id)?t:[...t,e])}async function p(e){var s;n(e);let l=await v(e.email),a=null==l?void 0:null===(s=l.data)||void 0===s?void 0:s.listMessages;a&&a.length>0&&t(a)}return(0,l.useEffect)(()=>{j&&(async()=>{i(await g(j))})()},[]),(0,l.useEffect)(()=>{if(f)return f.on("contact_added",N),()=>{f.off("contact_added",N)}},[f]),(0,s.jsxs)("div",{className:"  h-full overflow-y-auto ",children:[(0,s.jsx)("h1",{className:" text-[1.5rem] text-center",children:"contatos"}),(0,s.jsx)("button",{className:" text-green-700 border border-green-300 bg-green-200 p-2 hover:bg-green-300",onClick:()=>{e({item:"",modeOperation:"createContact"})},children:"Criar contato"}),(0,s.jsx)(r.u,{}),(0,s.jsx)("h1",{className:" text-center",children:"Lista de contatos"}),(0,s.jsx)("ul",{children:(null==m?void 0:m.length)>0?m.map((e,t)=>(0,s.jsxs)("li",{onClick:()=>p(e),className:"  cursor-pointer px-3 border border-gray-800 my-2".concat((null==u?void 0:u.email)===(null==e?void 0:e.email)?" bg-gray-500":""),children:[(0,s.jsx)("p",{className:"w-screen500:hidden",children:null==e?void 0:e.email}),(0,s.jsx)(d(),{href:"/WindowChat",className:" hidden w-screen500:flex",children:null==e?void 0:e.email})]},t)):(0,s.jsx)("li",{children:"sem contatos no momento"})})]})},x=n(2741),f=n(1828),h=n(8644),g=function(){let{userLoged:e,contactList:t,chattingTo:n,setChattingTo:i,returnList:c,setModalStatus:r,setContactList:o}=(0,l.useContext)(a._),{logout:u,checkUserByToken:d,setLoading:g}=(0,x.Z)();return(0,s.jsxs)("div",{className:"sideBarSquare px-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(h.bq1,{className:" iconPerson"}),(0,s.jsxs)("h3",{className:" text-2xl px-2 text-center",children:["Ol\xe1 sr. ",e.name,"!"]}),(0,s.jsx)(m,{})]}),(0,s.jsxs)("h3",{onClick:u,className:" justify-center  text-5xl flex border-green-600 border text-[1.1rem] list-none cursor-pointer btnExit mb-2",children:[(0,s.jsx)("p",{className:"",children:" sair"}),(0,s.jsx)(f.jZv,{className:"exitIcon"})]})]})},v=function(){let{getAllContacts:e}=(0,c.Z)(),{userLoged:t,contactList:n,chattingTo:r,setChattingTo:o,returnList:u,setModalStatus:d,setContactList:m}=(0,l.useContext)(a._),x=localStorage.getItem("token");return(0,l.useEffect)(()=>{(null==n?void 0:n.length)>0&&!r&&o(n[0])},[n,r]),(0,l.useEffect)(()=>{x&&(async()=>{m(await e(x))})()},[]),(0,s.jsxs)("div",{className:" flex flex-row h-screen",children:[(0,s.jsx)(g,{}),(0,s.jsx)("div",{className:"w-screen500:hidden w-full",children:(0,s.jsx)(i.default,{})})]})}},1101:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var s=n(5893),l=n(7294),a=n(3228),i=n(8773),c=n(7200),r=n(9696),o=n(8647),u=function(){let{socket:e,chattingTo:t,userLoged:n}=(0,l.useContext)(a._),i={from:"",to:"",content:"",_id:""},[u,d]=(0,l.useState)(i),{storageMessage:m}=(0,c.Z)();return(0,s.jsx)("form",{className:" sticky  w-full bg-slate-800 flex justify-center text-white",onSubmit:function(t){t.preventDefault(),u.content&&(null==e||e.emit("message",u),d(i))},children:(0,s.jsxs)("div",{className:" flex align-middle",children:[(0,s.jsx)("div",{className:" pt-5",children:(0,s.jsx)(r.Z,{type:"text",textLabel:"",name:"message",placeholder:"mensagem",handleOnChange:function(e){d({from:n.email,to:(null==t?void 0:t.email)?t.email:"",content:e.target.value,_id:(0,o.x0)()})},value:u.content})}),(0,s.jsx)("input",{type:"submit",value:"Enviar",className:" cursor-pointer border border-green-500 mt-2  \n ml-2 px-2 max-h-9 hover:bg-gray-900"})]})})},d=function(){let{userLoged:e,messageList:t,chattingTo:n,setMessageList:i}=(0,l.useContext)(a._),c=(0,l.useRef)(null);return(0,l.useEffect)(()=>{var e;(null==t?void 0:t.length)>0&&(null===(e=c.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))},[t]),(0,l.useEffect)(()=>{n||i([])},[n]),(0,s.jsx)("div",{className:"h-full box pt-1",children:(null==t?void 0:t.length)===0?(0,s.jsx)("div",{className:" px-1 h-full text-center",children:"sem menssagens no momento"}):(0,s.jsxs)("ul",{className:" overflow-y-scroll px-1 h-full max-h-[80.6vh]",children:[null==t?void 0:t.map((t,n)=>(0,s.jsxs)("li",{className:"".concat(e.email===t.from?"bg-green-500 ml-auto":"bg-gray-500"," flex flex-col  max-w-max px-2 mb-1"),children:[(0,s.jsx)("p",{className:" text-[0.7em]",children:e.email===t.from?"vo\xe7\xea":t.from}),(0,s.jsx)("p",{className:" text-[1em]",children:t.content})]},n)),(0,s.jsx)("div",{className:"",ref:c})]})})},m=function(){let{storageMessage:e,getListMessage:t}=(0,c.Z)(),{socket:n,userLoged:r,contactList:o,messageList:m,chattingTo:x,setMessageList:f,returnList:h,setModalStatus:g,modalStatus:v}=(0,l.useContext)(a._);return(0,l.useEffect)(()=>{n&&function(){let t=async t=>{await e(t),m.find(e=>e._id===(null==t?void 0:t._id))||f(e=>[...e,t])};null==n||n.on("receive_message",t),()=>{null==n||n.off("receive_message",t)}}()},[n,null==x?void 0:x.email]),(0,l.useEffect)(()=>{if((null==m?void 0:m.length)>0){let e=m.filter((e,t,n)=>t===n.findIndex(t=>t._id===e._id));e.length!==m.length&&f(e)}},[m]),(0,l.useEffect)(()=>{(async()=>{(null==x?void 0:x.email)&&f(await t(x.email))})()},[x]),(0,s.jsxs)("div",{className:" flex flex-col w-full h-screen",children:[(0,s.jsx)("h1",{className:" text-center text-xl bg-slate-800",children:(null==o?void 0:o.length)>0&&(0,s.jsxs)("div",{className:"my-4 ",children:["Falando com :",(0,s.jsxs)("span",{className:"text-green-600",children:[" ",null==x?void 0:x.email]}),(0,s.jsx)("button",{className:" ml-2",onClick:function(){g({item:"".concat(null==x?void 0:x._id),modeOperation:"deleteContact"})},children:(0,s.jsx)(i.AMf,{})})]})}),(0,s.jsx)(d,{}),(0,s.jsx)(u,{})]})}}},function(e){e.O(0,[365,509,888,774,179],function(){return e(e.s=6274)}),_N_E=e.O()}]);